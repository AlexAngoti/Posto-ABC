-- =========================
-- TABELAS
-- =========================

EXECUTE BLOCK AS
BEGIN
  IF (NOT EXISTS(
      SELECT 1 FROM RDB$RELATIONS WHERE RDB$RELATION_NAME = 'TANQUE'
  )) THEN
  BEGIN
    EXECUTE STATEMENT '
      CREATE TABLE TANQUE (
        ID    INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        NOME  VARCHAR(50) NOT NULL,
        TIPO  CHAR(1) NOT NULL,
        CONSTRAINT CK_TANQUE_TIPO CHECK (TIPO IN (''G'',''D''))
      )';
  END
END;

EXECUTE BLOCK AS
BEGIN
  IF (NOT EXISTS(
      SELECT 1 FROM RDB$RELATIONS WHERE RDB$RELATION_NAME = 'BOMBA'
  )) THEN
  BEGIN
    EXECUTE STATEMENT '
      CREATE TABLE BOMBA (
        ID        INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        ID_TANQUE INTEGER NOT NULL,
        NOME      VARCHAR(50) NOT NULL,
        CONSTRAINT FK_BOMBA_TANQUE
          FOREIGN KEY (ID_TANQUE) REFERENCES TANQUE(ID)
      )';
  END
END;

EXECUTE BLOCK AS
BEGIN
  IF (NOT EXISTS(
      SELECT 1 FROM RDB$RELATIONS WHERE RDB$RELATION_NAME = 'ABASTECIMENTO'
  )) THEN
  BEGIN
    EXECUTE STATEMENT '
      CREATE TABLE ABASTECIMENTO (
        ID           INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        DATA_ABAST   TIMESTAMP NOT NULL,
        ID_BOMBA     INTEGER NOT NULL,
        LITROS       NUMERIC(12,3) NOT NULL,
        VALOR_TOTAL  NUMERIC(12,2) NOT NULL,
        IMPOSTO      NUMERIC(12,2) NOT NULL,
        CONSTRAINT FK_ABAST_BOMBA
          FOREIGN KEY (ID_BOMBA) REFERENCES BOMBA(ID)
      )';
  END
END;

-- =========================
-- DADOS INICIAIS
-- =========================

EXECUTE BLOCK AS
BEGIN
  IF (NOT EXISTS(
      SELECT 1 FROM TANQUE WHERE NOME = 'Tanque Gasolina'
  )) THEN
    INSERT INTO TANQUE (NOME, TIPO)
    VALUES ('Tanque Gasolina', 'G');

  IF (NOT EXISTS(
      SELECT 1 FROM TANQUE WHERE NOME = 'Tanque Diesel'
  )) THEN
    INSERT INTO TANQUE (NOME, TIPO)
    VALUES ('Tanque Diesel', 'D');
END;

EXECUTE BLOCK AS
BEGIN
  IF (NOT EXISTS(
      SELECT 1 FROM BOMBA WHERE NOME = 'Bomba G1'
  )) THEN
    INSERT INTO BOMBA (ID_TANQUE, NOME)
    SELECT ID, 'Bomba G1'
      FROM TANQUE
     WHERE TIPO = 'G';

  IF (NOT EXISTS(
      SELECT 1 FROM BOMBA WHERE NOME = 'Bomba G2'
  )) THEN
    INSERT INTO BOMBA (ID_TANQUE, NOME)
    SELECT ID, 'Bomba G2'
      FROM TANQUE
     WHERE TIPO = 'G';

  IF (NOT EXISTS(
      SELECT 1 FROM BOMBA WHERE NOME = 'Bomba D1'
  )) THEN
    INSERT INTO BOMBA (ID_TANQUE, NOME)
    SELECT ID, 'Bomba D1'
      FROM TANQUE
     WHERE TIPO = 'D';

  IF (NOT EXISTS(
      SELECT 1 FROM BOMBA WHERE NOME = 'Bomba D2'
  )) THEN
    INSERT INTO BOMBA (ID_TANQUE, NOME)
    SELECT ID, 'Bomba D2'
      FROM TANQUE
     WHERE TIPO = 'D';
END;
